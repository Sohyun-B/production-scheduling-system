# 🔄 System Flow Diagram

## 전체 시스템 실행 흐름

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                사용자 인터페이스                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                    React Frontend (Port 3000)                         │    │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │    │
│  │  │   1단계 실행     │  │   2단계 실행     │  │   3단계 실행     │  ...   │    │
│  │  │   [버튼]        │  │   [버튼]        │  │   [버튼]        │        │    │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │    │
│  │  ┌─────────────────────────────────────────────────────────────────┐    │    │
│  │  │                    결과 표시 영역                                │    │    │
│  │  │  📊 데이터 로딩 결과  🔧 전처리 결과  📈 수율 예측 결과  ...        │    │    │
│  │  └─────────────────────────────────────────────────────────────────┘    │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ HTTP API 요청
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              API 오케스트레이션                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                    Node.js Backend (Port 3001)                        │    │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │    │
│  │  │  /stage1/       │  │  /stage2/       │  │  /stage3/       │  ...   │    │
│  │  │  load-data      │  │  preprocessing  │  │  yield-prediction│        │    │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │    │
│  │  ┌─────────────────────────────────────────────────────────────────┐    │    │
│  │  │                    요청 라우팅 및 에러 처리                        │    │    │
│  │  └─────────────────────────────────────────────────────────────────┘    │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ HTTP API 요청
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              스케줄링 엔진                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                    Python FastAPI (Port 8000)                         │    │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │    │
│  │  │  /api/v1/       │  │  /api/v1/       │  │  /api/v1/       │  ...   │    │
│  │  │  stage1/        │  │  stage2/        │  │  stage3/        │        │    │
│  │  │  load-data      │  │  preprocessing  │  │  yield-prediction│        │    │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │    │
│  │  ┌─────────────────────────────────────────────────────────────────┐    │    │
│  │  │                    스케줄링 알고리즘 실행                        │    │    │
│  │  │  • 데이터 전처리  • 수율 예측  • DAG 생성  • 스케줄링  • 결과처리  │    │    │
│  │  └─────────────────────────────────────────────────────────────────┘    │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ 데이터 저장/조회
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              데이터 저장소                                       │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                        Redis (Port 6379)                              │    │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │    │
│  │  │   세션 데이터    │  │   DataFrame     │  │   처리 결과      │  ...   │    │
│  │  │   저장소        │  │   저장소        │  │   저장소        │        │    │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 단계별 상세 실행 흐름

### 1단계: 데이터 로딩
```
사용자 클릭 → React → Node.js → Python FastAPI → Redis
    ↓           ↓        ↓           ↓            ↓
[1단계 실행] → POST → POST → JSON→DataFrame → 세션 저장
    ↑           ↑        ↑           ↑            ↑
[완료 표시] ← 응답 ← 응답 ← 세션ID ← 데이터 요약
```

### 2단계: 전처리
```
사용자 클릭 → React → Node.js → Python FastAPI → Redis
    ↓           ↓        ↓           ↓            ↓
[2단계 실행] → POST → POST → 데이터 로드 → 전처리 실행
    ↑           ↑        ↑           ↑            ↑
[완료 표시] ← 응답 ← 응답 ← 처리 결과 ← 결과 저장
```

### 3단계: 수율 예측
```
사용자 클릭 → React → Node.js → Python FastAPI → Redis
    ↓           ↓        ↓           ↓            ↓
[3단계 실행] → POST → POST → 데이터 로드 → 수율 예측
    ↑           ↑        ↑           ↑            ↑
[완료 표시] ← 응답 ← 응답 ← 예측 결과 ← 결과 저장
```

### 4단계: DAG 생성
```
사용자 클릭 → React → Node.js → Python FastAPI → Redis
    ↓           ↓        ↓           ↓            ↓
[4단계 실행] → POST → POST → 데이터 로드 → DAG 생성
    ↑           ↑        ↑           ↑            ↑
[완료 표시] ← 응답 ← 응답 ← 생성 결과 ← 결과 저장
```

### 5단계: 스케줄링 (비동기)
```
사용자 클릭 → React → Node.js → Python FastAPI → Redis
    ↓           ↓        ↓           ↓            ↓
[5단계 실행] → POST → POST → 데이터 로드 → 백그라운드 실행
    ↑           ↑        ↑           ↑            ↑
[시작 표시] ← 응답 ← 응답 ← 시작 메시지 ← 즉시 응답
    ↓
[상태 확인] → GET → GET → 상태 조회 → 완료 확인
    ↑           ↑        ↑           ↑            ↑
[완료 표시] ← 완료 ← 완료 ← 완료 상태 ← 결과 저장
```

### 6단계: 결과 후처리
```
사용자 클릭 → React → Node.js → Python FastAPI → Redis
    ↓           ↓        ↓           ↓            ↓
[6단계 실행] → POST → POST → 데이터 로드 → 결과 처리
    ↑           ↑        ↑           ↑            ↑
[완료 표시] ← 응답 ← 응답 ← 최종 결과 ← 결과 저장
```

## 데이터 흐름 상세

### 세션 데이터 구조
```json
{
  "session_id": "88cbf9d1-7fbc-4499-b0a1-1083828c33df",
  "stage1": {
    "dataframes": {
      "linespeed": "DataFrame",
      "operation_sequence": "DataFrame",
      "machine_master_info": "DataFrame",
      "yield_data": "DataFrame",
      "gitem_operation": "DataFrame",
      "operation_types": "DataFrame",
      "operation_delay": "DataFrame",
      "width_change": "DataFrame",
      "machine_rest": "DataFrame",
      "machine_allocate": "DataFrame",
      "machine_limit": "DataFrame",
      "order_data": "DataFrame"
    },
    "data_summary": {...}
  },
  "stage2": {
    "sequence_seperated_order": "DataFrame",
    "linespeed": "DataFrame",
    "processed_jobs": 2,
    "machine_constraints": {...}
  },
  "stage3": {
    "operation_sequence": "DataFrame",
    "predicted_yields": 2,
    "average_yield": 0.95
  },
  "stage4": {
    "dag_nodes": 2,
    "machines": 1,
    "dag_data": {...}
  },
  "stage5": {
    "status": "completed",
    "scheduled_jobs": 2,
    "schedule_data": {...}
  },
  "stage6": {
    "late_orders": 0,
    "results_summary": {...}
  }
}
```

## 에러 처리 흐름

### 일반적인 에러 처리
```
에러 발생 → Python FastAPI → Node.js → React → 사용자
    ↓           ↓            ↓        ↓        ↓
[알고리즘 오류] → HTTP 500 → HTTP 500 → 에러 표시 → [다시 시도]
```

### 세션 관련 에러
```
세션 없음 → Python FastAPI → Node.js → React → 사용자
    ↓           ↓            ↓        ↓        ↓
[404 에러] → HTTP 404 → HTTP 404 → 에러 표시 → [1단계부터 재시작]
```

### 네트워크 에러
```
연결 실패 → Node.js → React → 사용자
    ↓        ↓        ↓        ↓
[타임아웃] → HTTP 500 → 에러 표시 → [다시 시도]
```

## 성능 최적화 포인트

### 1. 비동기 처리
- 5단계 스케줄링은 `ThreadPoolExecutor`로 백그라운드 실행
- 사용자는 다른 작업을 계속할 수 있음

### 2. 세션 관리
- Redis를 통한 효율적인 세션 데이터 관리
- 각 단계별 독립적인 데이터 저장

### 3. 에러 복구
- 각 단계별 독립 실행으로 부분 실패 시 재시작 가능
- 세션 데이터 유지로 중간 단계부터 재시작 가능

### 4. 사용자 경험
- 실시간 로딩 애니메이션
- 단계별 진행 상황 표시
- 상세한 결과 데이터 시각화
