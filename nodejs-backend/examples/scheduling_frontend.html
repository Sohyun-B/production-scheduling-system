<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒì‚° ìŠ¤ì¼€ì¤„ë§ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .main-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #34495e;
            font-weight: 500;
        }

        .input-group input, 
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: linear-gradient(135deg, #2980b9, #21618c);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 8px;
            color: #7f8c8d;
        }

        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-5px);
        }

        .status-card .number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .status-card .label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #7f8c8d;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #3498db;
            border-bottom: 2px solid #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .log-container {
            height: 200px;
            overflow-y: auto;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 5px;
        }

        .log-entry.success {
            color: #2ecc71;
        }

        .log-entry.warning {
            color: #f39c12;
        }

        .log-entry.error {
            color: #e74c3c;
        }

        .log-entry.info {
            color: #3498db;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .results-table th {
            background: #34495e;
            color: white;
            font-weight: 500;
        }

        .results-table tr:hover {
            background: #f8f9fa;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .gantt-placeholder {
            width: 100%;
            height: 400px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border: 2px dashed #bdc3c7;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-size: 1.2em;
            margin: 20px 0;
        }

        .machine-schedule-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .machine-timeline {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #3498db;
        }

        .machine-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .machine-header h5 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.3em;
        }

        .machine-status {
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .timeline-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }

        .timeline-item:hover {
            transform: translateX(5px);
        }

        .time-range {
            min-width: 120px;
            font-weight: bold;
            font-size: 14px;
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            margin-left: 20px;
        }

        .gitem-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 12px;
        }

        .process-name {
            font-weight: 500;
            min-width: 80px;
        }

        .batch-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .batch-code {
            background: rgba(255, 255, 255, 0.3);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
        }

        .po-list {
            font-size: 11px;
            opacity: 0.9;
        }

        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-item .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-item .label {
            font-size: 0.9em;
            color: #6c757d;
        }

        .step-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .step-item.active {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .step-item.completed {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
        }

        .step-item.error {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #bdc3c7;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
            font-size: 14px;
        }

        .step-item.active .step-number {
            background: #2196f3;
        }

        .step-item.completed .step-number {
            background: #4caf50;
        }

        .step-item.error .step-number {
            background: #f44336;
        }

        .step-name {
            flex: 1;
            font-weight: 500;
            color: #2c3e50;
        }

        .step-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .step-item.active .step-status {
            background: #2196f3;
            color: white;
        }

        .step-item.completed .step-status {
            background: #4caf50;
            color: white;
        }

        .step-item.error .step-status {
            background: #f44336;
            color: white;
        }

        .step-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 8px;
            transition: all 0.3s ease;
        }

        .step-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .step-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .step-btn.running {
            background: #ff9800;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 25px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.4em;
            font-weight: 500;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .stage-summary {
            margin-bottom: 20px;
        }

        .stage-summary h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .stat-item .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-item .label {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .constraint-alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid;
        }

        .constraint-alert.success {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .constraint-alert.warning {
            background-color: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .constraint-alert.error {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9em;
        }

        .results-table th,
        .results-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .results-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .modal-footer {
            padding: 20px 25px;
            background-color: #f8f9fa;
            border-radius: 0 0 15px 15px;
            text-align: right;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .status-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .statistics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ­ ìƒì‚° ìŠ¤ì¼€ì¤„ë§ ì‹œìŠ¤í…œ</h1>
            <p class="subtitle">Level 4 DispatchPriority ì „ëµ ê¸°ë°˜ ìµœì í™” ìŠ¤ì¼€ì¤„ë§</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="section">
                    <h3>ğŸ“… ìŠ¤ì¼€ì¤„ë§ ì„¤ì •</h3>
                    <div class="input-group">
                        <label>ê¸°ì¤€ ë‚ ì§œ</label>
                        <input type="date" id="baseDate" value="2025-05-15">
                    </div>
                    <div class="input-group">
                        <label>ìœˆë„ìš° í¬ê¸° (ì¼)</label>
                        <select id="windowSize">
                            <option value="3">3ì¼</option>
                            <option value="5" selected>5ì¼</option>
                            <option value="7">7ì¼</option>
                            <option value="10">10ì¼</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>ìˆ˜ìœ¨ ê¸°ì¤€ ê¸°ê°„</label>
                        <select id="yieldPeriod">
                            <option value="12">1ë…„ (12ê°œì›”)</option>
                            <option value="6" selected>6ê°œì›”</option>
                            <option value="3">3ê°œì›”</option>
                        </select>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ›ï¸ ì œì–´</h3>
                    <button class="btn btn-danger" id="resetBtn" onclick="resetScheduling()">ğŸ”„ ì´ˆê¸°í™”</button>
                </div>
                
                <div class="info-box" style="margin-top: 15px; padding: 15px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #4caf50;">
                    <h4 style="margin: 0 0 10px 0; color: #2e7d32;">ğŸ’¡ ì‚¬ìš© ë°©ë²•</h4>
                    <p style="margin: 0; color: #424242; font-size: 0.9em;">
                        <strong>ë‹¨ê³„ë³„ ì‹¤í–‰:</strong> ê° ë‹¨ê³„ì˜ "ì‹¤í–‰" ë²„íŠ¼ì„ ìˆœì„œëŒ€ë¡œ í´ë¦­í•˜ì—¬ ì§„í–‰í•˜ì„¸ìš”.<br>
                        <strong>ìˆœì„œ:</strong> 1ë‹¨ê³„ â†’ 2ë‹¨ê³„ â†’ 3ë‹¨ê³„ â†’ 4ë‹¨ê³„ â†’ 5ë‹¨ê³„ â†’ 6ë‹¨ê³„
                    </p>
                </div>

                <div class="section">
                    <h3>ğŸ“‹ ë‹¨ê³„ë³„ ì§„í–‰ ìƒí™©</h3>
                    <div id="stepProgress">
                        <div class="step-item" id="step1">
                            <div class="step-number">1</div>
                            <div class="step-name">ë°ì´í„° ê²€ì¦</div>
                            <div class="step-status">ëŒ€ê¸°</div>
                            <button class="step-btn" onclick="runSingleStep(1)" disabled>ì‹¤í–‰</button>
                        </div>
                        <div class="step-item" id="step2">
                            <div class="step-number">2</div>
                            <div class="step-name">ì „ì²˜ë¦¬</div>
                            <div class="step-status">ëŒ€ê¸°</div>
                            <button class="step-btn" onclick="runSingleStep(2)" disabled>ì‹¤í–‰</button>
                        </div>
                        <div class="step-item" id="step3">
                            <div class="step-number">3</div>
                            <div class="step-name">ìˆ˜ìœ¨ ì˜ˆì¸¡</div>
                            <div class="step-status">ëŒ€ê¸°</div>
                            <button class="step-btn" onclick="runSingleStep(3)" disabled>ì‹¤í–‰</button>
                        </div>
                        <div class="step-item" id="step4">
                            <div class="step-number">4</div>
                            <div class="step-name">DAG ìƒì„±</div>
                            <div class="step-status">ëŒ€ê¸°</div>
                            <button class="step-btn" onclick="runSingleStep(4)" disabled>ì‹¤í–‰</button>
                        </div>
                        <div class="step-item" id="step5">
                            <div class="step-number">5</div>
                            <div class="step-name">ìŠ¤ì¼€ì¤„ë§</div>
                            <div class="step-status">ëŒ€ê¸°</div>
                            <button class="step-btn" onclick="runSingleStep(5)" disabled>ì‹¤í–‰</button>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ“Š ì‹¤ì‹œê°„ ë¡œê·¸</h3>
                    <div class="log-container" id="logContainer">
                        <div class="log-entry success">[ì‹œìŠ¤í…œ] ìƒì‚° ìŠ¤ì¼€ì¤„ë§ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</div>
                        <div class="log-entry info">[ì‹œìŠ¤í…œ] 1~5ë‹¨ê³„ ìŠ¤ì¼€ì¤„ë§ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. 1ë‹¨ê³„ "ë°ì´í„° ê²€ì¦" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</div>
                    </div>
                </div>
            </div>

            <div class="main-panel">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">ìŠ¤ì¼€ì¤„ë§ ì¤€ë¹„ ì™„ë£Œ (0%)</div>
                </div>

                <div class="status-cards">
                    <div class="status-card">
                        <div class="number" id="totalOrders">0</div>
                        <div class="label">ì´ ì£¼ë¬¸ ìˆ˜</div>
                    </div>
                    <div class="status-card">
                        <div class="number" id="processedJobs">0</div>
                        <div class="label">ì²˜ë¦¬ ì‘ì—… ìˆ˜</div>
                    </div>
                    <div class="status-card">
                        <div class="number" id="makespan">0.0</div>
                        <div class="label">ì˜ˆìƒ Makespan (ì¼)</div>
                    </div>
                    <div class="status-card">
                        <div class="number" id="lateOrders">0</div>
                        <div class="label">ì§€ê° ì£¼ë¬¸</div>
                    </div>
                    <div class="status-card">
                        <div class="number" id="onTimeRate">0%</div>
                        <div class="label">ë‚©ê¸° ì¤€ìˆ˜ìœ¨</div>
                    </div>
                    <div class="status-card">
                        <div class="number" id="machineUtilization">0%</div>
                        <div class="label">ê¸°ê³„ ê°€ë™ë¥ </div>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="showTab('gantt')">ğŸ“Š ê°„íŠ¸ ì°¨íŠ¸</button>
                    <button class="tab" onclick="showTab('results')">ğŸ“‹ ìµœì¢… ê²°ê³¼</button>
                    <button class="tab" onclick="showTab('dataLoading')">ğŸ“„ ë°ì´í„° ë¡œë”©</button>
                    <button class="tab" onclick="showTab('preprocessing')">ğŸ”„ ì „ì²˜ë¦¬ ê²°ê³¼</button>
                    <button class="tab" onclick="showTab('analysis')">ğŸ“ˆ ë¶„ì„ ë¦¬í¬íŠ¸</button>
                </div>

                <div class="tab-content active" id="gantt">
                    <div class="gantt-placeholder" id="ganttPlaceholder">
                        ğŸ¯ ê°„íŠ¸ ì°¨íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤<br>
                        <small>ìŠ¤ì¼€ì¤„ë§ ì™„ë£Œ í›„ ê¸°ê³„ë³„ ì‘ì—… íƒ€ì„ë¼ì¸ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</small>
                    </div>
                </div>

                <div class="tab-content" id="results">
                    <div class="alert alert-info">
                        <strong>ğŸ“‹ ìµœì¢… ê²°ê³¼</strong><br>
                        ìŠ¤ì¼€ì¤„ë§ì´ ì™„ë£Œë˜ë©´ ì—¬ê¸°ì— ìƒì„¸í•œ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                    <div id="resultsContent"></div>
                </div>

                <div class="tab-content" id="dataLoading">
                    <div class="alert alert-info">
                        <strong>ğŸ“„ ë°ì´í„° ë¡œë”©</strong><br>
                        ë°ì´í„° ê²€ì¦ì´ ì™„ë£Œë˜ë©´ ì—¬ê¸°ì— ë¡œë”©ëœ ë°ì´í„° ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                    <div id="dataLoadingContent"></div>
                </div>

                <div class="tab-content" id="preprocessing">
                    <div class="alert alert-info">
                        <strong>ğŸ”„ ì „ì²˜ë¦¬ ê²°ê³¼</strong><br>
                        ì „ì²˜ë¦¬ê°€ ì™„ë£Œë˜ë©´ ì—¬ê¸°ì— ì „ì²˜ë¦¬ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                    <div id="preprocessingContent"></div>
                </div>

                <div class="tab-content" id="analysis">
                    <div class="alert alert-info">
                        <strong>ğŸ“ˆ ë¶„ì„ ë¦¬í¬íŠ¸</strong><br>
                        ìŠ¤ì¼€ì¤„ë§ì´ ì™„ë£Œë˜ë©´ ì—¬ê¸°ì— ì„±ê³¼ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                    <div id="analysisContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API ì„œë¹„ìŠ¤ í´ë˜ìŠ¤
        class SchedulingAPI {
            constructor() {
                this.baseURL = 'http://localhost:3000/api/scheduling';
            }

            async request(endpoint, options = {}) {
                try {
                    const response = await fetch(`${this.baseURL}${endpoint}`, {
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        },
                        ...options
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    return await response.json();
                } catch (error) {
                    console.error('API ìš”ì²­ ì˜¤ë¥˜:', error);
                    throw error;
                }
            }

            async healthCheck() {
                return this.request('/health');
            }

            async runFullScheduling(data) {
                return this.request('/run-full', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
            }

            async runStep(endpoint, data) {
                return this.request(endpoint, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
            }

            async getSessionStatus(sessionId) {
                return this.request(`/status/${sessionId}`);
            }
        }

        // ì „ì—­ ë³€ìˆ˜
        const api = new SchedulingAPI();
        let currentSessionId = null; // localStorageì—ì„œ ë¡œë“œí•˜ì§€ ì•Šê³  ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±
        let isScheduling = false;
        let currentStep = 0;
        let stepResults = {};

        // ìŠ¤ì¼€ì¤„ë§ ë‹¨ê³„ ì •ì˜
        const SCHEDULING_STEPS = [
            {
                step: 1,
                name: 'ë°ì´í„° ê²€ì¦',
                endpoint: 'validation',
                progress: 10,
                description: 'JSON ë°ì´í„° ê²€ì¦ ì¤‘...'
            },
            {
                step: 2,
                name: 'ì „ì²˜ë¦¬',
                endpoint: 'preprocessing',
                progress: 25,
                description: 'ì£¼ë¬¸ ë°ì´í„° ì „ì²˜ë¦¬ ì¤‘...'
            },
            {
                step: 3,
                name: 'ìˆ˜ìœ¨ ì˜ˆì¸¡',
                endpoint: 'yield-prediction',
                progress: 35,
                description: 'ìˆ˜ìœ¨ ì˜ˆì¸¡ ì²˜ë¦¬ ì¤‘...'
            },
            {
                step: 4,
                name: 'DAG ìƒì„±',
                endpoint: 'dag-creation',
                progress: 50,
                description: 'ì£¼ë¬¸ ë¬¶ìŒ ìƒì„± ì¤‘...'
            },
            {
                step: 5,
                name: 'ìŠ¤ì¼€ì¤„ë§',
                endpoint: 'scheduling',
                progress: 75,
                description: 'ìŠ¤ì¼€ì¤„ë§ ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰ ì¤‘...'
            },
            {
                step: 6,
                name: 'ê²°ê³¼ ì²˜ë¦¬',
                endpoint: 'results',
                progress: 100,
                description: 'ê²°ê³¼ í›„ì²˜ë¦¬ ì¤‘...'
            }
        ];

        // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        function updateProgress(progress, text) {
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = text;
        }

        function addLogEntry(type, message) {
            const logContainer = document.getElementById('logContainer');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${time}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStatusCard(id, value) {
            document.getElementById(id).textContent = value;
        }

        function showTab(tabName) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function setButtonState(start, pause, reset) {
            document.getElementById('resetBtn').disabled = !reset;
        }


        // ë‹¨ì¼ ë‹¨ê³„ ì‹¤í–‰ í•¨ìˆ˜
        async function runSingleStep(stepNumber) {
            if (isScheduling) {
                addLogEntry('warning', 'ì´ë¯¸ ìŠ¤ì¼€ì¤„ë§ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.');
                return;
            }

            // ì„¸ì…˜ IDê°€ ì—†ìœ¼ë©´ ìƒì„±
            if (!currentSessionId) {
                currentSessionId = `session_${Date.now()}`;
                addLogEntry('info', `ì„¸ì…˜ ID ìƒì„±: ${currentSessionId}`);
            }

        const stepInfo = {
            1: { step: 1, name: 'ë°ì´í„° ê²€ì¦', endpoint: '/step/validation' },
            2: { step: 2, name: 'ì „ì²˜ë¦¬', endpoint: '/step/preprocessing' },
            3: { step: 3, name: 'ìˆ˜ìœ¨ ì˜ˆì¸¡', endpoint: '/step/yield-prediction' },
            4: { step: 4, name: 'DAG ìƒì„±', endpoint: '/step/dag-creation' },
            5: { step: 5, name: 'ìŠ¤ì¼€ì¤„ë§', endpoint: '/step/scheduling' }
        }[stepNumber];

            if (!stepInfo) {
                addLogEntry('error', 'ì˜ëª»ëœ ë‹¨ê³„ ë²ˆí˜¸ì…ë‹ˆë‹¤.');
                return;
            }

            // ì´ì „ ë‹¨ê³„ê°€ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸ (1ë‹¨ê³„ ì œì™¸)
            if (stepNumber > 1) {
                const prevStepElement = document.getElementById(`step${stepNumber - 1}`);
                if (!prevStepElement.classList.contains('completed')) {
                    addLogEntry('warning', `ë¨¼ì € ${stepNumber - 1}ë‹¨ê³„ë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”.`);
                    return;
                }
            }

            isScheduling = true;
            setButtonState(false, false, false);
            updateStepProgress(stepNumber, 'running');
            updateStepButton(stepNumber, 'running');

            try {
                const config = {
                    baseDate: document.getElementById('baseDate').value,
                    windowSize: parseInt(document.getElementById('windowSize').value),
                    yieldPeriod: parseInt(document.getElementById('yieldPeriod').value)
                };

                addLogEntry('info', `${stepInfo.name} ì‹œì‘...`);

                const stepData = await executeStep(stepInfo, config, currentSessionId);
                updateStepResults(stepNumber, stepData);
                
                addLogEntry('success', `${stepInfo.name} ì™„ë£Œ!`);
                
                // ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ í™œì„±í™” (1-5ë‹¨ê³„ë§Œ)
                if (stepNumber < 5) {
                    const nextStepElement = document.getElementById(`step${stepNumber + 1}`);
                    if (nextStepElement) {
                        const nextButton = nextStepElement.querySelector('.step-btn');
                        if (nextButton) {
                            nextButton.disabled = false;
                        }
                    }
                }

            } catch (error) {
                addLogEntry('error', `${stepInfo.name} ì‹¤íŒ¨: ${error.message}`);
                updateStepProgress(stepNumber, 'error');
                updateStepButton(stepNumber, 'error');
            } finally {
                isScheduling = false;
                setButtonState(false, false, true);
            }
        }

        // ë‹¨ê³„ë³„ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStepButton(stepNumber, status) {
            const stepElement = document.getElementById(`step${stepNumber}`);
            if (!stepElement) {
                console.warn(`Step ${stepNumber} element not found`);
                return;
            }
            const button = stepElement.querySelector('.step-btn');
            
            if (status === 'running') {
                button.textContent = 'ì‹¤í–‰ì¤‘...';
                button.classList.add('running');
                button.disabled = true;
            } else if (status === 'completed') {
                button.textContent = 'ì™„ë£Œ';
                button.disabled = true;
                button.classList.remove('running');
            } else if (status === 'error') {
                button.textContent = 'ì‹¤íŒ¨';
                button.disabled = false;
                button.classList.remove('running');
            } else {
                button.textContent = 'ì‹¤í–‰';
                button.disabled = false;
                button.classList.remove('running');
            }
        }

        // ë‹¨ê³„ë³„ ì‹¤í–‰ í•¨ìˆ˜
        async function executeStep(stepInfo, config, sessionId) {
            // session_id í™•ì¸ ë° ë””ë²„ê¹…
            if (!sessionId) {
                sessionId = `session_${Date.now()}`;
                addLogEntry('warning', `Session IDê°€ ì—†ì–´ì„œ ìƒˆë¡œ ìƒì„±: ${sessionId}`);
            }
            
            let requestData = { sessionId: sessionId };
            addLogEntry('info', `ë‹¨ê³„ ${stepInfo.step} ì‹¤í–‰ - Session ID: ${sessionId}`);
            console.log(`Step ${stepInfo.step} using session ID:`, sessionId);

            // ì²« ë²ˆì§¸ ë‹¨ê³„(ê²€ì¦)ì˜ ê²½ìš° ì„¤ì • ë°ì´í„°ë§Œ í¬í•¨
            if (stepInfo.step === 1) {
                requestData = {
                    windowDays: config.windowSize,
                    sessionId: sessionId,
                    baseDate: config.baseDate,
                    yieldPeriod: config.yieldPeriod
                };
            }

            const response = await api.runStep(stepInfo.endpoint, requestData);
            
            if (!response.success) {
                throw new Error(response.error || `${stepInfo.name} ì‹¤í–‰ ì‹¤íŒ¨`);
            }

            return response.data;
        }


        function resetScheduling() {
            isScheduling = false;
            currentSessionId = null;
            currentStep = 0;
            stepResults = {};
            
            updateProgress(0, 'ìŠ¤ì¼€ì¤„ë§ ì¤€ë¹„ ì™„ë£Œ (0%)');
            updateStatusCard('totalOrders', '0');
            updateStatusCard('processedJobs', '0');
            updateStatusCard('makespan', '0.0');
            updateStatusCard('lateOrders', '0');
            updateStatusCard('onTimeRate', '0%');
            updateStatusCard('machineUtilization', '0%');
            
            // ë‹¨ê³„ë³„ ì§„í–‰ ìƒí™© ì´ˆê¸°í™” (1-5ë‹¨ê³„ë§Œ)
            for (let i = 1; i <= 5; i++) {
                updateStepProgress(i, 'waiting');
                updateStepButton(i, 'waiting');
            }
            
            // ì²« ë²ˆì§¸ ë‹¨ê³„ ë²„íŠ¼ë§Œ í™œì„±í™”
            const firstStepButton = document.getElementById('step1').querySelector('.step-btn');
            firstStepButton.disabled = false;
            
            // ê²°ê³¼ íƒ­ ì´ˆê¸°í™”
            document.getElementById('resultsContent').innerHTML = '';
            document.getElementById('dataLoadingContent').innerHTML = '';
            document.getElementById('preprocessingContent').innerHTML = '';
            document.getElementById('analysisContent').innerHTML = '';
            
            // ê°„íŠ¸ ì°¨íŠ¸ ì´ˆê¸°í™”
            document.getElementById('ganttPlaceholder').innerHTML = `
                ğŸ¯ ê°„íŠ¸ ì°¨íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤<br>
                <small>ìŠ¤ì¼€ì¤„ë§ ì™„ë£Œ í›„ ê¸°ê³„ë³„ ì‘ì—… íƒ€ì„ë¼ì¸ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</small>
            `;
            
            setButtonState(false, false, true);
            addLogEntry('info', 'ì‹œìŠ¤í…œ ì´ˆê¸°í™”ë¨');
        }

        // ë‹¨ê³„ë³„ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
        function updateStepProgress(step, status) {
            const stepElement = document.getElementById(`step${step}`);
            if (!stepElement) {
                console.warn(`Step ${step} element not found`);
                return;
            }
            const statusElement = stepElement.querySelector('.step-status');
            
            // ëª¨ë“  ë‹¨ê³„ì˜ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.step-item').forEach(item => {
                item.classList.remove('active', 'completed', 'error');
            });
            
            // í˜„ì¬ ë‹¨ê³„ì— ë”°ë¥¸ í´ë˜ìŠ¤ ì¶”ê°€
            if (status === 'active') {
                stepElement.classList.add('active');
                statusElement.textContent = 'ì§„í–‰ì¤‘';
            } else if (status === 'completed') {
                stepElement.classList.add('completed');
                statusElement.textContent = 'ì™„ë£Œ';
            } else if (status === 'error') {
                stepElement.classList.add('error');
                statusElement.textContent = 'ì˜¤ë¥˜';
            } else {
                statusElement.textContent = 'ëŒ€ê¸°';
            }
        }

        // ë‹¨ê³„ë³„ ê²°ê³¼ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStepResults(step, data) {
            // ë‹¨ê³„ ì™„ë£Œ í‘œì‹œ
            updateStepProgress(step, 'completed');
            updateStepButton(step, 'completed');
            
            switch(step) {
                case 1: // ë°ì´í„° ê²€ì¦
                    updateDataLoadingTab(data);
                    showStageModal("ğŸ“Š ë°ì´í„° ê²€ì¦ ì™„ë£Œ", getDataLoadingContent(data));
                    break;
                case 2: // ì „ì²˜ë¦¬
                    updatePreprocessingTab(data);
                    showStageModal("ğŸ”„ ì „ì²˜ë¦¬ ì™„ë£Œ", getPreprocessingContent(data));
                    break;
                case 3: // ìˆ˜ìœ¨ ì˜ˆì¸¡
                    updateYieldTab(data);
                    showStageModal("ğŸ“Š ìˆ˜ìœ¨ ì˜ˆì¸¡ ì™„ë£Œ", getYieldContent(data));
                    break;
                case 4: // DAG ìƒì„±
                    updateDagTab(data);
                    showStageModal("ğŸ”— DAG ìƒì„± ì™„ë£Œ", getDagContent(data));
                    break;
                case 5: // ìŠ¤ì¼€ì¤„ë§
                    updateSchedulingTab(data);
                    showStageModal("ğŸ‰ ì „ì²´ ìŠ¤ì¼€ì¤„ë§ ì™„ë£Œ!", getSchedulingContent(data));
                    break;
            }
        }

        // ìµœì¢… ê²°ê³¼ í†µí•© í•¨ìˆ˜
        function updateFinalResults() {
            // ëª¨ë“  ë‹¨ê³„ì˜ ê²°ê³¼ë¥¼ í†µí•©í•˜ì—¬ ìµœì¢… í†µê³„ ì—…ë°ì´íŠ¸
            const finalData = {
                validation: stepResults[1],
                preprocessing: stepResults[2],
                yieldPrediction: stepResults[3],
                dagCreation: stepResults[4],
                scheduling: stepResults[5],
                results: stepResults[6]
            };

            // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
            if (stepResults[6]) {
                const results = stepResults[6];
                if (results.totalOrders) updateStatusCard('totalOrders', results.totalOrders);
                if (results.processedJobs) updateStatusCard('processedJobs', results.processedJobs);
                if (results.makespan) updateStatusCard('makespan', results.makespan);
                if (results.lateOrders) updateStatusCard('lateOrders', results.lateOrders);
                if (results.onTimeRate) updateStatusCard('onTimeRate', results.onTimeRate);
                if (results.machineUtilization) updateStatusCard('machineUtilization', results.machineUtilization);
            }
        }

        function updateResults(data) {
            if (!data) return;

            // ê¸°ë³¸ í†µê³„ ì—…ë°ì´íŠ¸
            if (data.totalOrders) updateStatusCard('totalOrders', data.totalOrders);
            if (data.processedJobs) updateStatusCard('processedJobs', data.processedJobs);
            if (data.makespan) updateStatusCard('makespan', data.makespan);
            if (data.lateOrders) updateStatusCard('lateOrders', data.lateOrders);
            if (data.onTimeRate) updateStatusCard('onTimeRate', data.onTimeRate);
            if (data.machineUtilization) updateStatusCard('machineUtilization', data.machineUtilization);

            // ê²°ê³¼ íƒ­ ì—…ë°ì´íŠ¸
            updateResultsTab(data);
            updateDataLoadingTab(data);
            updatePreprocessingTab(data);
            updateAnalysisTab(data);
            updateGanttChart(data);
        }

        function updateResultsTab(data) {
            const content = document.getElementById('resultsContent');
            
            if (data.machineSchedule) {
                content.innerHTML = `
                    <h4>ğŸ“… ê¸°ê³„ë³„ ì‘ì—… ìŠ¤ì¼€ì¤„</h4>
                    <div class="machine-schedule-container">
                        ${Object.entries(data.machineSchedule).map(([machine, schedule]) => `
                            <div class="machine-timeline">
                                <div class="machine-header">
                                    <h5>ğŸ”§ ${machine}</h5>
                                    <span class="machine-status">í™œì„±</span>
                                </div>
                                <div class="timeline-items">
                                    ${schedule.map(item => `
                                        <div class="timeline-item" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                                            <div class="time-range">${item.startTime} - ${item.endTime}</div>
                                            <div class="item-info">
                                                <div class="gitem-badge">${item.gitem}</div>
                                                <div class="process-name">${item.process}</div>
                                                <div class="batch-info">
                                                    <span class="batch-code">${item.batch || 'N/A'}</span>
                                                    <span class="po-list">${item.poNumbers ? item.poNumbers.join(', ') : 'N/A'}</span>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="alert alert-info">
                        ê¸°ê³„ ìŠ¤ì¼€ì¤„ ì •ë³´ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        function updateDataLoadingTab(data) {
            const content = document.getElementById('dataLoadingContent');
            
            if (data.validation) {
                content.innerHTML = `
                    <h4>ğŸ“„ ë°ì´í„° ê²€ì¦ ê²°ê³¼</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${data.validation.totalFiles || 0}</div>
                            <div class="label">ê²€ì¦ëœ íŒŒì¼</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.validation.totalRecords || 0}</div>
                            <div class="label">ì´ ë ˆì½”ë“œ</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.validation.errors || 0}</div>
                            <div class="label">ì˜¤ë¥˜ ìˆ˜</div>
                        </div>
                    </div>
                    <div class="alert alert-success">
                        âœ… ë°ì´í„° ê²€ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="alert alert-info">
                        ë°ì´í„° ê²€ì¦ ì •ë³´ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        function updatePreprocessingTab(data) {
            const content = document.getElementById('preprocessingContent');
            
            if (data.preprocessing) {
                content.innerHTML = `
                    <h4>ğŸ”„ ì „ì²˜ë¦¬ ê²°ê³¼</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${data.preprocessing.originalOrders || 0}</div>
                            <div class="label">ì›ë³¸ ì£¼ë¬¸</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.preprocessing.processedOrders || 0}</div>
                            <div class="label">ì²˜ë¦¬ëœ ì£¼ë¬¸</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.preprocessing.excludedItems || 0}</div>
                            <div class="label">ì œì™¸ëœ ì•„ì´í…œ</div>
                        </div>
                    </div>
                    <div class="alert alert-success">
                        âœ… ì „ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="alert alert-info">
                        ì „ì²˜ë¦¬ ì •ë³´ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        function updateAnalysisTab(data) {
            const content = document.getElementById('analysisContent');
            
            if (data && (data.analysis || data.makespan || data.onTimeRate)) {
                content.innerHTML = `
                    <h4>ğŸ“ˆ ì„±ê³¼ ë¶„ì„</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${data.onTimeRate || data.analysis?.onTimeRate || '0%'}</div>
                            <div class="label">ë‚©ê¸° ì¤€ìˆ˜ìœ¨</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.machineUtilization || data.analysis?.machineUtilization || '0%'}</div>
                            <div class="label">ê¸°ê³„ ê°€ë™ë¥ </div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.totalChangeovers || data.analysis?.totalChangeovers || 0}</div>
                            <div class="label">ê³µì •êµì²´ íšŸìˆ˜</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.changeoverTime || data.analysis?.changeoverTime || '0ë¶„'}</div>
                            <div class="label">ê³µì •êµì²´ì‹œê°„</div>
                        </div>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="alert alert-info">
                        ë¶„ì„ ì •ë³´ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        // ìˆ˜ìœ¨ ì˜ˆì¸¡ íƒ­ ì—…ë°ì´íŠ¸
        function updateYieldTab(data) {
            const content = document.getElementById('preprocessingContent');
            
            if (data && data.yieldData) {
                content.innerHTML = `
                    <h4>ğŸ“Š ìˆ˜ìœ¨ ì˜ˆì¸¡ ê²°ê³¼</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${data.totalGitems || 0}</div>
                            <div class="label">ë¶„ì„ ëŒ€ìƒ GITEM</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.averageYield || '0%'}</div>
                            <div class="label">í‰ê·  ìˆ˜ìœ¨</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.noYieldData || 0}</div>
                            <div class="label">ìˆ˜ìœ¨ ë°ì´í„° ì—†ìŒ</div>
                        </div>
                    </div>
                    <div class="alert alert-success">
                        âœ… ìˆ˜ìœ¨ ì˜ˆì¸¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        // DAG ìƒì„± íƒ­ ì—…ë°ì´íŠ¸
        function updateDagTab(data) {
            const content = document.getElementById('preprocessingContent');
            
            if (data && data.dagData) {
                content.innerHTML = `
                    <h4>ğŸ”— ì£¼ë¬¸ ë¬¶ìŒ ìƒì„± ê²°ê³¼</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${data.totalGroups || 0}</div>
                            <div class="label">ì´ ë¬¶ìŒ ê·¸ë£¹</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.originalOrders || 0}</div>
                            <div class="label">ì›ë³¸ P/O ìˆ˜</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.averageGroupSize || 0}</div>
                            <div class="label">í‰ê·  ë¬¶ìŒ í¬ê¸°</div>
                        </div>
                    </div>
                    <div class="alert alert-success">
                        âœ… ì£¼ë¬¸ ë¬¶ìŒ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        // ìŠ¤ì¼€ì¤„ë§ íƒ­ ì—…ë°ì´íŠ¸
        function updateSchedulingTab(data) {
            const content = document.getElementById('resultsContent');
            
            if (data && data.scheduling) {
                content.innerHTML = `
                    <h4>âš¡ ìŠ¤ì¼€ì¤„ë§ ì‹¤í–‰ ê²°ê³¼</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${data.makespan || '0'}</div>
                            <div class="label">Makespan (ì¼)</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.machineUtilization || '0%'}</div>
                            <div class="label">ê¸°ê³„ ê°€ë™ë¥ </div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.lateOrders || 0}</div>
                            <div class="label">ì§€ê° ì£¼ë¬¸</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data.totalChangeovers || 0}</div>
                            <div class="label">ê³µì •êµì²´ íšŸìˆ˜</div>
                        </div>
                    </div>
                    <div class="alert alert-success">
                        âœ… ìŠ¤ì¼€ì¤„ë§ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        function updateGanttChart(data) {
            const placeholder = document.getElementById('ganttPlaceholder');
            
            if (data.machineSchedule) {
                placeholder.innerHTML = `
                    <div style="width: 100%; height: 100%; background: linear-gradient(90deg, #e8f5e8 0%, #f0f8f0 25%, #fff3e0 50%, #ffe0e0 75%, #e8f5e8 100%); 
                                display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;">
                        <div style="position: absolute; top: 20px; left: 20px; right: 20px; display: flex; justify-content: space-between; font-size: 12px; color: #666;">
                            <span>ì‹œì‘</span><span>ì§„í–‰ì¤‘</span><span>ì™„ë£Œ</span>
                        </div>
                        <div style="font-size: 1.2em; color: #2c3e50; font-weight: bold;">ğŸ“Š ê°„íŠ¸ ì°¨íŠ¸ (ê¸°ê³„ë³„ ìŠ¤ì¼€ì¤„)</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: #7f8c8d;">
                            ì´ ${Object.keys(data.machineSchedule).length}ê°œ ê¸°ê³„ | Makespan: ${data.makespan || '0'}ì¼
                        </div>
                    </div>
                `;
            }
        }

        // ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            addLogEntry('success', 'ìƒì‚° ìŠ¤ì¼€ì¤„ë§ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
            addLogEntry('info', 'Node.js ë°±ì—”ë“œ ì—°ê²° í™•ì¸ ì¤‘...');
            
            // í—¬ìŠ¤ ì²´í¬
            api.healthCheck()
                .then(response => {
                    addLogEntry('success', 'ë°±ì—”ë“œ ì„œë²„ ì—°ê²° ì„±ê³µ');
                })
                .catch(error => {
                    addLogEntry('error', `ë°±ì—”ë“œ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
                });
        });

        // Modal Functions
        function showStageModal(title, content) {
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            const stageModal = document.getElementById('stageModal');
            
            if (!modalTitle || !modalBody || !stageModal) {
                console.warn('Modal elements not found');
                return;
            }
            
            modalTitle.textContent = title;
            modalBody.innerHTML = content;
            stageModal.style.display = 'block';
        }

        function closeModal() {
            const stageModal = document.getElementById('stageModal');
            if (stageModal) {
                stageModal.style.display = 'none';
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('stageModal');
            if (modal && event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // ê° ë‹¨ê³„ë³„ ì½˜í…ì¸  ìƒì„± í•¨ìˆ˜ë“¤
        function getDataLoadingContent(data) {
            const loadedFiles = data?.loaded_files || {};
            const totalFiles = Object.keys(loadedFiles).length;
            const successFiles = Object.values(loadedFiles).filter(file => file.status === 'success').length;
            
            return `
                <div class="stage-summary">
                    <h4>ë°ì´í„° ë¡œë”© ê²°ê³¼</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${data?.total_orders || 0}</div>
                            <div class="label">ì´ ì£¼ë¬¸</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data?.total_linespeed || 0}</div>
                            <div class="label">ë¼ì¸ìŠ¤í”¼ë“œ</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data?.total_machines || 0}</div>
                            <div class="label">ê¸°ê³„ì •ë³´</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${successFiles}/${totalFiles}</div>
                            <div class="label">ë¡œë“œëœ íŒŒì¼</div>
                        </div>
                    </div>
                </div>
                <div class="constraint-alert success">
                    <strong>âœ… ë°ì´í„° ë¡œë”© ì„±ê³µ!</strong><br>
                    ëª¨ë“  JSON íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }

        function getPreprocessingContent(data) {
            const originalOrders = data?.original_orders_count || 0;
            const processedJobs = data?.processed_jobs_count || 0;
            const originalGitems = data?.original_gitems_count || 0;
            const processedGitems = data?.processed_gitems_count || 0;
            const excludedGitems = data?.excluded_gitems_count || 0;
            const excludedGitemsList = data?.excluded_gitems || [];
            
            return `
                <div class="stage-summary">
                    <h4>ì „ì²˜ë¦¬ ê²°ê³¼</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${originalOrders} / ${processedJobs}</div>
                            <div class="label">ì´ ì£¼ë¬¸ / ì‹¤ì œ ì‚¬ìš©</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${originalGitems} / ${processedGitems}</div>
                            <div class="label">GITEM ì¢…ë¥˜ / ì‹¤ì œ ì‚¬ìš©</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${excludedGitems}</div>
                            <div class="label">ì œì™¸ëœ GITEM ê°œìˆ˜</div>
                        </div>
                    </div>
                </div>
                
                ${excludedGitems > 0 ? `
                <div class="constraint-alert warning">
                    <strong>âš ï¸ ì¥ë¹„ ì œì•½: ${excludedGitems}ê°œ GITEMì´ ì „ìš©ì¥ë¹„ ì‚¬ìš©ë¶ˆê°€ë¡œ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤.</strong><br>
                    ì œì™¸ëœ GITEM ìƒì„¸ (${excludedGitems}ê°œ):<br>
                    <div style="margin-top: 10px; font-size: 0.9em;">
                        ${excludedGitemsList.slice(0, 5).map(gitem => `â€¢ ${gitem}`).join('<br>')}
                        ${excludedGitemsList.length > 5 ? `<br>â€¢ ... ì™¸ ${excludedGitemsList.length - 5}ê°œ` : ''}
                    </div>
                </div>
                ` : ''}
                
                <div class="constraint-alert success">
                    <strong>âœ… ì „ì²˜ë¦¬ ì™„ë£Œ!</strong><br>
                    ì£¼ë¬¸ ë°ì´í„°ê°€ ìŠ¤ì¼€ì¤„ë§ì— ì í•©í•œ í˜•íƒœë¡œ ì „ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }

        function getYieldContent(data) {
            return `
                <div class="stage-summary">
                    <h4>ìˆ˜ìœ¨ ì˜ˆì¸¡ ê²°ê³¼</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${data?.yield_prediction_completed ? 'ì™„ë£Œ' : 'ì§„í–‰ì¤‘'}</div>
                            <div class="label">ì˜ˆì¸¡ ìƒíƒœ</div>
                        </div>
                    </div>
                </div>
                <div class="constraint-alert success">
                    <strong>âœ… ìˆ˜ìœ¨ ì˜ˆì¸¡ ì™„ë£Œ!</strong><br>
                    ê° ê³µì •ë³„ ìˆ˜ìœ¨ì´ ì˜ˆì¸¡ë˜ì–´ ìƒì‚° ê³„íšì´ ìµœì í™”ë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }

        function getDagContent(data) {
            return `
                <div class="stage-summary">
                    <h4>DAG ìƒì„± ê²°ê³¼</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${data?.node_count || 0}</div>
                            <div class="label">ìƒì„±ëœ ë…¸ë“œ</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data?.machine_count || 0}</div>
                            <div class="label">ê¸°ê³„ ìˆ˜</div>
                        </div>
                    </div>
                </div>
                <div class="constraint-alert success">
                    <strong>âœ… DAG ìƒì„± ì™„ë£Œ!</strong><br>
                    ì‘ì—… ê°„ ì˜ì¡´ì„± ê·¸ë˜í”„ê°€ ìƒì„±ë˜ì–´ ìŠ¤ì¼€ì¤„ë§ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }

        function getSchedulingContent(data) {
            return `
                <div class="stage-summary">
                    <h4>ìµœì¢… ìŠ¤ì¼€ì¤„ë§ ê²°ê³¼</h4>
                    <div class="statistics-grid">
                        <div class="stat-item">
                            <div class="value">${data?.total_jobs_scheduled || 0}</div>
                            <div class="label">ì´ ì‘ì—… ìˆ˜</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data?.late_jobs_count || 0}</div>
                            <div class="label">ì§€ê° ì‘ì—…</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${Math.round((data?.makespan || 0) / 48)}ì¼</div>
                            <div class="label">ì´ ì†Œìš”ì¼</div>
                        </div>
                        <div class="stat-item">
                            <div class="value">${data?.late_days_sum || 0}</div>
                            <div class="label">ì´ ì§€ê° ì¼ìˆ˜</div>
                        </div>
                    </div>
                </div>
                <div class="constraint-alert success">
                    <strong>ğŸ‰ ì „ì²´ ìŠ¤ì¼€ì¤„ë§ ì™„ë£Œ!</strong><br>
                    ëª¨ë“  ë‹¨ê³„ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìµœì ì˜ ìƒì‚° ìŠ¤ì¼€ì¤„ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }

    </script>

    <!-- Stage Confirmation Modal -->
    <div id="stageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ë‹¨ê³„ ì™„ë£Œ</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- ë™ì ìœ¼ë¡œ ë‚´ìš©ì´ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal()">í™•ì¸</button>
            </div>
        </div>
    </div>
</body>
</html>
